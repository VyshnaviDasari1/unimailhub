<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>UniMailHub</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body>

<!-- ================= TOP BAR ================= -->
<div class="topbar">

    <div class="profile-container" onclick="toggleProfileMenu()">
        <div class="profile-icon"
             th:text="${#strings.substring(userEmail,0,1).toUpperCase()}">
        </div>

        <div id="profileMenu" class="profile-menu">
            <p class="profile-email" th:text="${activeAccount}"></p>
            <hr>

            <!-- Account switching -->
            <div class="account-list">
                <div th:each="account : ${sessionAccounts}" class="account-item">
                    <span th:if="${account == activeAccount}" class="active-account" th:text="${account}">‚úì</span>
                    <a th:if="${account != activeAccount}" th:href="@{'/switch-account?email=' + ${account}}" th:text="${account}"></a>
                </div>
            </div>

            <hr>
            <a th:href="@{/add-account}">‚ûï Add another account</a>
            <a th:href="@{/home?tab=settings}">‚öô Settings</a>
            <a th:href="@{'/logout-account?email=' + ${activeAccount}}">üö™ Logout</a>
        </div>
    </div>

</div>

<!-- ================= MAIN LAYOUT ================= -->
<div class="container">

    <!-- ===== LEFT SIDEBAR ===== -->
    <div class="sidebar">
        
        <div class="sidebar-logo">
    <img th:src="@{/images/unimailhub-logo.png}"
         alt="UniMailHub Logo"
         class="sidebar-logo-img">
    <span>UniMailHub</span>
</div>
                <ul class="menu">
            <li class="compose" onclick="openCompose()">‚úâ Compose</li>

            <li th:classappend="${activeTab}=='inbox' ? 'active'">
                <a href="/home?tab=inbox">üì• Inbox</a>
            </li>

            <li th:classappend="${activeTab}=='starred' ? 'active'">
                <a href="/home?tab=starred">‚≠ê Starred</a>
            </li>

            <li th:classappend="${activeTab}=='sent' ? 'active'">
                <a href="/home?tab=sent">üì§ Sent</a>
            </li>

            <li th:classappend="${activeTab}=='jobs' ? 'active'">
                <a href="/home?tab=jobs">üíº Jobs</a>
            </li>

            <li th:classappend="${activeTab}=='trash' ? 'active'">
                <a href="/home?tab=trash">üóë Trash</a>
            </li>
        </ul>
    </div>

    <!-- ===== MAIN CONTENT (CENTER) ===== -->
    <div class="content">

        <!-- Title -->
        <h2 th:text="${activeTab == 'starred' ? 'Starred'
            : (activeTab == 'sent' ? 'Sent'
            : (activeTab == 'trash' ? 'Trash'
            : (activeTab == 'jobs' ? 'Jobs'
            : (activeTab == 'settings' ? 'Settings' : 'Inbox'))))}">
        </h2>

        <!-- Search Bar (hide in settings) -->
        <form th:if="${activeTab != 'settings'}"
              method="get"
              action="/home"
              class="search-bar">

            <input type="hidden" name="tab" th:value="${activeTab}">
            <input type="text"
                   name="search"
                   placeholder="Search mail by subject"
                   th:value="${search}">
            <button type="submit">üîç</button>
        </form>

        <!-- ================= MAIL LIST (CENTERED) ================= -->
        <div th:if="${activeTab != 'settings'}" class="mail-list">

            <div class="mail-item" th:each="mail : ${mails}">

                <a class="mail-subject"
                   th:text="${mail.subject}"
                   th:href="@{/home(tab=${activeTab}, read=${mail.id})}">
                </a>

                <div class="mail-actions">

                    <a th:if="${activeTab != 'trash'}"
                       class="mail-star"
                       th:href="@{'/star/' + ${mail.id} + '?tab=' + ${activeTab}}"
                       th:text="${mail.starred} ? '‚òÖ' : '‚òÜ'">
                    </a>

                    <a th:if="${activeTab != 'trash'}"
                       class="mail-trash"
                       th:href="@{'/trash/' + ${mail.id} + '?tab=' + ${activeTab}}">
                        üóë
                    </a>

                    <a th:if="${activeTab == 'trash'}"
                       class="mail-delete"
                       href="#"
                       th:onclick="|confirmDelete(${mail.id})|">
                        ‚ùå
                    </a>

                </div>
            </div>
        </div>

        <!-- ================= JOBS LIST ================= -->
        <div th:if="${activeTab == 'jobs'}" class="jobs-container">

            <!-- Jobs Search and Filters -->
            <div class="jobs-filters">
                <form method="get" action="/home" class="jobs-search-form">
                    <input type="hidden" name="tab" value="jobs">
                    <input type="text" name="keyword" placeholder="Search jobs by title or company" th:value="${keyword}">
                    <select name="jobType">
                        <option value="">All Types</option>
                        <option value="Full-time" th:selected="${jobType == 'Full-time'}">Full-time</option>
                        <option value="Part-time" th:selected="${jobType == 'Part-time'}">Part-time</option>
                        <option value="Contract" th:selected="${jobType == 'Contract'}">Contract</option>
                        <option value="Internship" th:selected="${jobType == 'Internship'}">Internship</option>
                    </select>
                    <button type="submit">üîç Search</button>
                </form>
            </div>

            <!-- Jobs List -->
            <div class="jobs-list">
                <div th:if="${#lists.isEmpty(jobs)}" class="no-jobs">
                    <p>No job opportunities found. Jobs will be automatically detected from your emails.</p>
                </div>

                <div th:each="job : ${jobs}" class="job-card">
                    <div class="job-header">
                        <h3 th:text="${job.jobTitle != null ? job.jobTitle : 'Job Title'}">Job Title</h3>
                        <span class="job-type" th:text="${job.jobType != null ? job.jobType : 'Full-time'}">Full-time</span>
                    </div>

                    <div class="job-company">
                        <span th:text="${job.companyName != null ? job.companyName : 'Company Name'}">Company Name</span>
                    </div>

                    <div class="job-details">
                        <p><strong>Posted:</strong> <span th:text="${job.datePosted != null ? #temporals.format(job.datePosted, 'MMM dd, yyyy') : 'Date not available'}">Date</span></p>
                    </div>

                    <div class="job-actions">
                        <a th:if="${job.applicationLink != null and !job.applicationLink.isEmpty()}" th:href="${job.applicationLink}" target="_blank" class="apply-btn">Apply Now</a>
                        <button th:if="${job.status != 'APPLIED'}" th:attr="onclick='markApplied(' + ${job.id} + ')'" class="mark-applied-btn">Mark Applied</button>
                        <span th:if="${job.status == 'APPLIED'}" class="applied-status">‚úÖ Applied</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= SETTINGS PANEL ================= -->
        <div th:if="${activeTab == 'settings'}" class="settings-panel">

            <a href="/home?tab=inbox" class="settings-back-btn">‚Üê Back to Inbox</a>

            <h2>Settings</h2>

            <div class="settings-card about-card">
                <h3>About UniMailHub</h3>
                <p>
                    <b>UniMailHub</b> is a web-based email management system inspired by Gmail.
                    It provides a clean, intuitive interface for managing your email communications.
                </p>

                <h4>Core Features</h4>
                <ul>
                    <li>üì• Inbox - Receive and organize incoming emails</li>
                    <li>üì§ Sent - Track emails you've sent</li>
                    <li>‚≠ê Priority - Star important emails for quick access</li>
                    <li>üîî Alerts - Security notifications for new devices</li>
                    <li>üíº Jobs - Background email processing</li>
                    <li>üîí Security - Multi-device login verification</li>
                </ul>

                <h4>Technology Stack</h4>
                <ul>
                    <li><b>Backend:</b> Spring Boot (Java)</li>
                    <li><b>Frontend:</b> Thymeleaf, HTML5, CSS3, JavaScript</li>
                    <li><b>Database:</b> MySQL</li>
                    <li><b>Email:</b> MailHog (Development), SMTP (Production)</li>
                    <li><b>Build:</b> Maven</li>
                </ul>

                <h4>Project Information</h4>
                <p>
                    This application demonstrates modern web development practices and enterprise-level
                    email system architecture. It includes features like multi-account support, secure
                    authentication, file attachments, and responsive design.
                </p>
                <p>
                    <b>Version:</b> 1.0.0<br>
                    <b>Built for:</b> Educational and demonstration purposes
                </p>
            </div>
        </div>

    </div>
</div>

<!-- ================= COMPOSE MODAL ================= -->
<div id="composeModal" class="compose-overlay">
    <div class="compose-card">
        <div class="compose-header">
            <h3>New Message</h3>
            <span class="close-btn" onclick="closeCompose()">‚úï</span>
        </div>

        <form method="post" action="/send" enctype="multipart/form-data" id="composeForm">
            <input type="email" name="toEmail" placeholder="To" required>
            <input type="text" name="cc" placeholder="Cc">
            <input type="text" name="subject" placeholder="Subject">

            <label class="attach-btn">üìé Attach
                <input type="file" name="files" multiple hidden>
            </label>

            <textarea name="message" placeholder="Message" required></textarea>

            <div class="compose-actions">
                <button type="button" class="clear-btn" onclick="clearCompose()">Clear</button>
                <button type="submit" class="send-btn">‚û§</button>
            </div>
        </form>
    </div>
</div>

<!-- ================= READ MAIL POPUP ================= -->
<div class="compose-overlay"
     th:if="${selectedMail != null}"
     style="display:flex">

    <div class="compose-card">

        <div class="compose-header">
            <a class="close-btn" th:href="@{/home(tab=${activeTab})}">‚Üê</a>
            <h3 th:text="${selectedMail.subject}"></h3>
        </div>

        <div class="mail-sub-header">
            <p><b>From:</b> <span th:text="${selectedMail.fromEmail}"></span></p>
            <p><b>To:</b> <span th:text="${selectedMail.toEmail}"></span></p>
        </div>

        <hr>

        <div class="mail-body">
            <p th:text="${selectedMail.message}"></p>
        </div>

        <div th:if="${selectedMail.attachments != null and !selectedMail.attachments.isEmpty()}">
            <h4>Attachments</h4>
            <ul>
                <li th:each="att : ${selectedMail.attachments}">
                    <a th:href="@{'/attachment/download/' + ${att.id}}"
                       th:text="${att.fileName}"
                       download></a>
                </li>
            </ul>
        </div>

    </div>
</div>

<script>
function openCompose() {
    document.getElementById("composeModal").style.display = "flex";
}
function closeCompose() {
    document.getElementById("composeModal").style.display = "none";
}
function clearCompose() {
    document.getElementById("composeForm").reset();
}
function toggleProfileMenu() {
    const menu = document.getElementById("profileMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}
window.onclick = function(event) {
    if (!event.target.closest('.profile-container')) {
        const menu = document.getElementById("profileMenu");
        if (menu) menu.style.display = "none";
    }
}
function confirmDelete(mailId) {
    if (confirm("Are you sure you want to delete this mail permanently?")) {
        window.location.href = "/delete/" + mailId;
    }
}
function markApplied(jobId) {
    if (confirm("Mark this job as applied?")) {
        window.location.href = "/jobs/apply/" + jobId;
    }
}
</script>

</body>
</html>
