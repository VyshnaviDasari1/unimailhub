<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>UniMailHub</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body>

<!-- Top Bar -->
<div class="topbar">


    <!-- Profile Section -->
    <div class="profile-container" onclick="toggleProfileMenu()">
        <div class="profile-icon"
             th:text="${#strings.substring(userEmail,0,1).toUpperCase()}">
        </div>

        <div id="profileMenu" class="profile-menu">
            <p class="profile-email" th:text="${userEmail}"></p>
            <hr>
            <a href="#">âš™ Settings</a>
            <a href="/logout">ğŸšª Logout</a>
        </div>
    </div>

</div>


<!-- Main Layout -->
<div class="container">

    <!-- Left Sidebar -->
    <div class="sidebar">
        <h2 class="logo">UniMailHub</h2>

        <ul class="menu">
            <li class="compose" onclick="openCompose()">âœ‰ Compose</li>

            <li th:classappend="${activeTab}=='inbox' ? 'active'">
                <a href="/home?tab=inbox">ğŸ“¥ Inbox</a>
            </li>

            <li th:classappend="${activeTab}=='starred' ? 'active'">
                <a href="/home?tab=starred">â­ Starred</a>
            </li>

            <li th:classappend="${activeTab}=='sent' ? 'active'">
                <a href="/home?tab=sent">ğŸ“¤ Sent</a>
            </li>

            <li th:classappend="${activeTab}=='trash' ? 'active'">
                <a href="/home?tab=trash">ğŸ—‘ Trash</a>
            </li>

        </ul>
    </div>

    <!-- Main Content Area -->
    <div class="content">

        <h2 th:text="${activeTab == 'starred' ? 'Starred' : (activeTab == 'sent' ? 'Sent' : 'Inbox')}"></h2>

        <!-- Search Bar -->
        <form method="get" action="/home" class="search-bar">
            <input type="hidden" name="tab" th:value="${activeTab}">
            <input type="text"
                name="search"
                placeholder="Search mail by subject"
                th:value="${search}">
            <button type="submit">ğŸ”</button>
        </form>


        <!-- Mail List -->

    <div class="mail-item" th:each="mail : ${mails}">
        <span class="mail-subject"
            th:text="${mail.subject}"
            th:onclick="|window.location.href='/mail/${mail.id}'|">
        </span>

        <div class="mail-actions">

            <!-- Star -->
            <a class="mail-star"
            th:href="@{'/star/' + ${mail.id} + '?tab=' + ${activeTab}}"
            th:text="${mail.starred} ? 'â˜…' : 'â˜†'">
            </a>

            <!-- Trash -->
            <a class="mail-trash"
            th:href="@{'/trash/' + ${mail.id} + '?tab=' + ${activeTab}}">
                ğŸ—‘
            </a>

        </div>
    </div>

    </div>

</div>

<!-- Compose Popup (centered version) -->
<div id="composeModal" class="compose-overlay">
    <div class="compose-card">
        <div class="compose-header">
            <h3>New Message</h3>
            <span class="close-btn" onclick="closeCompose()">âœ•</span>
        </div>

        <form method="post" action="/send" id="composeForm">
            <input type="email" name="toEmail" placeholder="To" required>
            <input type="text" name="cc" placeholder="Cc">
            <input type="text" name="subject" placeholder="Subject">

            <textarea name="message" placeholder="Message" required></textarea>

            <div class="compose-actions">
                <button type="button" class="clear-btn" onclick="clearCompose()">Clear</button>
                <button type="submit" class="send-btn">â¤</button>
            </div>
        </form>
    </div>
</div>

<script>
function openCompose() {
    document.getElementById("composeModal").style.display = "flex";
}

function closeCompose() {
    document.getElementById("composeModal").style.display = "none";
}

function clearCompose() {
    document.getElementById("composeForm").reset();
}

function toggleProfileMenu() {
    const menu = document.getElementById("profileMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

// Close dropdown when clicking outside
window.onclick = function(event) {
    if (!event.target.closest('.profile-container')) {
        const menu = document.getElementById("profileMenu");
        if (menu) menu.style.display = "none";
    }
}
</script>

</body>
</html>
